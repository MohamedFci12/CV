# Configuring a Linux server

## About
This project is a baseline installation of a Linux server and prepare it to host my web applications. secured my server from a number of attack vectors, installed and configure a database server, and deployed one of my existing web applications onto it.

# Server details
IP address: 18.185.35.159

#install putty

# putty key private
 
PuTTY-User-Key-File-2: ssh-rsa
Encryption: none
Comment: rsa-key-20181102
Public-Lines: 6
AAAAB3NzaC1yc2EAAAABJQAAAQEAwZLO3WVHGisHGU5YKKGshQDHsPI7N4W5WqYI
cNWs1nRnNXr9j9dF4tA8DtCg5zAZ41F8ufTPfHz//Pa8VQikzIEakUEQkCU4TuoU
Uo0iV5NJxvwX0LI+KuWWXvW0cst+lq0zlPmK9rLlV3h7B6W9jWfBj3OluEhEENOB
ILHBHjSpOQYsXqUhkAdKqnPuHk8Qc6OKnZ69Q7K9On5HiCtPWGSnIWX09eXmQvDd
Cqzxd9dtKgBUOmEThhBkmQ31ameqSi3Pj3x0OjA/BWQBvq1E2xxBTVWGhBvkAt+M
+2OTeS4mm497qEH07pMAkNSekjGfnJw/g+rOEJZY7xJtqu6GVQ==
Private-Lines: 14
AAABAQCSfO+SyS7jXtTwjlCNc23Mb0sCch75laEGVCIQMv9WLpNLEPc8a47VJ/YZ
DJVwrsd7l5yoZjwm2yKV6ya84/JVkiHxYaurWm/NBCsOCfB5n+TN7zSd7quWFYaN
DPdCHXSNs4D7HbVFEcJQCCXAmRnSyw8Exjg4bgn+5T8fqRyFjk9emzkbE8DYetaf
fTlsOIuAZtEIPyDqqFjBhlKzewnU2n4oYTojt3djPYzxyND9d8s3eBvieqErBP1m
bgF1y6RUeSPUlu6NtZWLd5LQ3HpRl6BweCWsrcrQSW3yjIRbP2ykpE8SYISK4baF
r5IVchQUNj5BePaxeSl9dZECR+ItAAAAgQD6ldgcwKG+8t2S33oNJlNNsQoW8P73
B+ymrZP1GDPpf/1kuVYRQwsKg4FAzAnpnht0iEPmpT5GOdCNcIKrndlxxkBtjTDJ
eTc0NsfoTRpKPLI7B7Lh/WJgZEeoSziezfpbdxj1Of/I/xMua6p1U9kM5/D0WbC4
kBEREunbrCU/6QAAAIEAxcGXzUyEthFi0wqCHjtDU4/Icb0nyHNnoUQLHALLqyO0
QET9IAOoa7MnayO1GEGm0Kq5JCncLy7UrOEwx96cjRRNThcWgc7bYJ908t2UNGlz
8kNNBQcdAMI23IsV2A4Nsm941MzU6oEesz2mun1vinVjnXhH9BYAmi067c4O240A
AACBAM8UOSYC3UOAybyvnAJ+0hHaKkbTh91KVclIM4WTVbJh6zNjJ0SHuLiD6r+G
6ZlHkB+FqxLiCsXYlvnY57gHVn22hC0P7uibYM7mlJhZ9iQ7tLlHEuCw8ZQpV4RN
RwVLmCJ9KOKO8NACTTelfAhZgjDuZCaKeBLKsyluQ7o+sufZ
Private-MAC: 21968e9c8a4c1d8cc0283856a453c2873c17635c

#SSH private key for grader user

bTjbfBX+EN3+L4MLCCMQl6vbXDhKWffCiyPl0UVs2inVUHAIfjnrONZsSYxK1G6X
st1MWbCdAs8XSMzl7jtbjh+8flWFgoDcKcEx+2jNqrXlt1CPag84yrviMB7bzYjf
ltBdv75AdwwBVW54q6lMvKd4pWyEviVzodSkl5wwZRkpDGabhXmvzL1xLy6AETG1
FYjPgJlwO9NjKntSJBgvOWCp7brJ218vBS0IlAdbDl+Oqj3jaJLSEOmLpG8MfgaQ
BQL3Ol3G04uMK28zgjQGnVr+/4ZcIB9FOi91RD9N0HtsaA5tzTxGvTB2qOI0m+zE
t6lxG1VIYQtzrb1/rnOSpGePD4uUDCEflERCFvQzimT2vSGsr8BM7sfRVo7sbTui
uG8bRcmcveDSvJsx0gxaInu4H+y+GHTMKb/Fi0Di2WDn+p3b7ux3+8qi6jpdfn1c
hMXXXEjzm728vHRp8xKOfEc8DJ+uCNKZNCG8ubTHqXoM+9tfE/KT8aWQAQQ6+hik
QwJ6bL41cIf8JLRL4tRQrJ7bXo9AYmdOTK+ZKJ8s/19dADzavJvhA1cx9FjiJf9y
nXrfNJwzuc58LmN/DnJeEJSQmqaRORP9+nhs2fLVtQBUAPHwt47ZmfeBgqAPZ/Ee
GEQNbe0nnygdfq/cPfNGd5Cm5dREyvmsLLj/7Hk3tJ6vTuVrbDuW+C6P1/q3M7HA
Gg8ruvQ7OSavX2+CP08hGl8Zo5wJnkro5sc+3WwO2A6QX7KaAVid0+qtaJEakuyj
HzOj0Ic+II8aPppAI7lpW28fscWhPj97/WYhia4cgGHWr1ctgiisx8FrNrXGgGlt
C/fsIu05Fgk7Cc7FmyOtf5ZkR66edExk45FC2QjNva+so+sLJ8BlN09nLwSbs3g6
/96eVp78dvRrWw/P7Ylx7QKtuGcY+eZ5EVoeXxe9HBUDtbqe6paxZ8TSPyLzUSGk
yh5566MIq8QhmjSneM1JKD/j1DFIiQfmtH5vhFrxj6YNToJAWQAEpQF6b4WLQhFD
y4jwGUV1sn2ZBMGurWfylrYnXUdhxpFNE0YJWg47NxIpFrJp4mZAAJbHDKl5NwbU
MlwXQGY+kx4owpa1y4X7QR2SN05X+vsMTpGtRmMBcLb2nLwrHNCVxUIioZR08Hk+
x/gqxNyJwaYgfEZ3RVm4IiU+3QH16/JpqsCH6SB+3VYKE+gU9wlpfOt4n4qE1Oj2
YFAyFu94K7U2dlL4H5XSNyEAxCxytCI6OdWWWr/k6rfi4bywN++pDWHhmOaapHoC
IIZDEoJIYxUM6RE2cfi5f337GkWvQYyvel0dc3L4RdLFLxLXE9m64Xx8oefWkVga
U2Ja30gRU65u+rF3QG5lSp3uuNninaxlR4Deu6KaUAp4F+euzOypQg/yxG5ytabn
 
#password for grader user is 123
#passphrase for grader user is 123 
#Server IP address 18.185.35.159
# SSH port: `2200`

# Configuration changes
## Add user
Add user `grader` with command: `sudo adduser grader`


## Add user grader to sudo group
Assuming your Linux distro has a `sudo` group (like Ubuntu 16.04), simply add the user to
this admin group:
```
sudo usermod -a -G sudo grader
```

## Update all currently installed packages

- Update the package indexes `apt-get update` 

- To actually upgrade the installed packages `apt-get upgrade` 


## Set-up SSH keys for user grader
As root user do:
```
mkdir /home/grader/.ssh
chown grader:grader /home/grader/.ssh
chmod 700 /home/grader/.ssh
cp /root/.ssh/authorized_keys /home/grader/.ssh/
chown grader:grader /home/grader/.ssh/authorized_keys
chmod 644 /home/grader/.ssh/authorized_keys
```

Can now login as the `grader` user using the command:
`ssh grader@18.185.35.159 -p 22 -i ~/.ssh/linuxrsa`


## Disable root login
Change the PasswordAuthentication line to no instead of yes in the file `sudo nano /etc/ssh/sshd_config`:

- So it reads:
```
PasswordAuthentication no
```
Do ` sudo service ssh restart` for the changes to take effect.


## Change timezone to UTC
Check the timezone with the `date` command. This will display the current timezone after the time.
If it's not UTC change it like this:

`sudo timedatectl set-timezone UTC`

## Add SSH port 2200

- Reconfigure the port for the ssh server:
`sudo nano /etc/ssh/sshd_config`
- and add:
`port 2200`

- Then reload the configuration:
`sudo service ssh force-reload`

- and connect via:

`ssh grader@18.185.35.159 -p 2200 -i ~/.ssh/linuxrsa`


## Configuration Uncomplicated Firewall (UFW)
By default, block all incoming connections on all ports:

`sudo ufw default deny incoming`

- Allow outgoing connection on all ports:

`sudo ufw default allow outgoing`

- Allow incoming connection for SSH on port 2200:

`sudo ufw allow 2200/tcp`

- Allow incoming connections for HTTP on port 80:

`sudo ufw allow www`

- Allow incoming connection for NTP on port 123:

`sudo ufw allow ntp`

- To check the rules that have been added before enabling the firewall use:

`sudo ufw show added`

- To enable the firewall, use:

`sudo ufw enable`

- To check the status of the firewall, use:

`sudo ufw status`

## Install Apache to serve a Python mod_wsgi application
- Install Apache:

`sudo apt-get install apache2`

- Install the `libapache2-mod-wsgi` package:

`sudo apt-get install libapache2-mod-wsgi`

## Install and configure the PostgreSQL database system
 ```
sudo apt-get update
sudo apt-get install postgresql postgresql-contrib
```
 
## Create a PostgreSQL role named catalog and a database named catalog
```
sudo -u postgres -i
postgres:~$ createuser catalog
postgres:~$ createdb catalog
postgres:~$ psql catalog
postgres=# ALTER DATABASE catalog OWNER TO catalog;
postgres=# ALTER USER catalog WITH PASSWORD 'catalog';
postgres=# \q
postgres:~$ exit

```

## Install Flask, SQLAlchemy, etc
- Issue the following commands:
```
sudo apt-get install python-psycopg2 python-flask
sudo apt-get install python-sqlalchemy python-pip
sudo pip install oauth2client
sudo pip install requests
sudo pip install httplib2
sudo pip install flask-seasurf
```


## Install Git version control software
`sudo apt-get install git`

## Clone the repository that contains Project Catalog app

```
cd /var/www
sudo mkdir project
sudo chown -R grader:grader project
cd project
sudo git clone https://github.com/MahmoudSakr96/Item-Catalog-master.git project
```

## Configure the Catalog app
- Change `app.py` to `__init__.py`
-  Provide the full path (or location) to all the files, instead of just the filename

## Configure Google OAuth
- Add the public IP address of your server to the “Authorized javascript origins”
- Add the public IP address to the client secrets JSON file

## Configure the web application to connect to the PostgreSQL database instead of a SQLite database
 ```
 sudo nano /var/www/project/project/app.py
 -Change the DATABASE_URI setting in the file from 'sqlite:///catalogitems.db' to 'postgresql://catalog:catalog@localhost/catalog', and save
``` 

## Configure the Database to connect to the PostgreSQL database instead of a SQLite database
  ```
 sudo nano /var/www/project/project/dbsetup.py
 -Change the DATABASE_URI setting in the file from 'sqlite:///catalogitems.db' to 'postgresql://catalog:catalog@localhost/catalog', and save
 ```
 
 ## Configure Apache to serve the web application using WSGI
- Create the web application WSGI file.
 ```
sudo nano /var/www/project/app.wsgi
```
- Add the following lines to the file, and save the file.
```
#!/usr/bin/python
import sys 
import logging
logging.basicConfig(stream=sys.stderr)
sys.path.insert(0,"/var/www/project/")
from project4 import app as application
application.secret_key = 'super_secret_key'

```
- Update the Apache configuration file to serve the web application with WSGI.
```
sudo nano /etc/apache2/sites-enabled/000-default.conf
```
- Add the following line inside the `<VirtualHost *:80>` element, and save the file.
```
        ServerName 18.185.35.159
	ServerAdmin mahmoud@gmail.com
	WSGIScriptAlias / /var/www/project/app.wsgi
	<Directory /var/www/project4/project4>
		Order allow,deny
		Allow from all
	</Directory>
	Alias /static /var/www//project/project/static
	<Directory /var/www/project/project/static/>
		Order allow,deny
		Allow from all
	</Directory>
	ErrorLog ${APACHE_LOG_DIR}/error.log
	LogLevel warn
	CustomLog ${APACHE_LOG_DIR}/access.log combined
 
```

- Restart Apache.
```
sudo apache2ctl restart
```

## References
- [Ask Ubuntu](http://askubuntu.com/)
- [PosgreSQL Docs](https://www.postgresql.org/docs/9.5/static/index.html)
- [Apache Docs](https://httpd.apache.org/docs/2.4/)
- [How To Install and Use PostgreSQL on Ubuntu 14.04](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-14-04)
- Stackoverflow and the Readme's of other FSND students on Github.
- **Special Thanks to *[SteveWooding](https://github.com/SteveWooding)* for a very helpful README**
